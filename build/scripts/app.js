!function t(e,a,r){function n(s,i){if(!a[s]){if(!e[s]){var c="function"==typeof require&&require;if(!i&&c)return c(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=a[s]={exports:{}};e[s][0].call(u.exports,function(t){var a=e[s][1][t];return n(a?a:t)},u,u.exports,t,e,a,r)}return a[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(t){t("./scripts/map.js")()},{"./scripts/map.js":4}],2:[function(t,e){var a=t("d3"),r=t("./map-helpers.js"),n=t("underscore"),o={voteTotalScale:a.scale.linear().range([0,50]),append:function(t){s.setPartyVotes(s.stateRaces(t)),s.setPartyVotesMax();var e=parseInt(a.select("#map-container").style("width")),n=20;if(960>e)var o=e/2,i=0;else var i=100,o=e;var c=150,l=a.select("#legend-container").append("svg").attr("height",c).attr("width",e);l.append("text").attr("x",o-i).attr("y",(s.partyVotes.length+1)*n-175).attr("dy",".95em").style("text-anchor","middle").style("font-weight","bold").text("National vote total");var u=l.selectAll(".legend").data(s.partyVotes).enter().append("g").attr("class","legend").attr("transform",function(t,e){return"translate(0,"+(e*n+(s.partyVotes.length*n-125))+")"});u.append("rect").attr("x",o-i).attr("width",function(t){return s.voteTotalScale(t.votes)}).attr("height",n-2).style("fill",function(t){return r.partyScale(t.name)}),u.append("text").attr("x",o-i-4).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(t){return t.name}),u.append("text").attr("x",function(t){return o-i+4+s.voteTotalScale(t.votes)}).attr("y",9).attr("dy",".35em").attr("class","legend-values").text(function(t){return r.bbwNumberFormat(t.votes)})},stateRaces:function(t){return t.filter(function(t){return void 0===t.fipsCode})},setPartyVotes:function(t){var e=r.getPartyVotes(t);s.partyVotes=n.sortBy(e,function(t){return-t.votes}).slice(0,8)},partyVotes:void 0,setPartyVotesMax:function(){var t=a.max(s.partyVotes,function(t){return t.votes});s.voteTotalScale.domain([0,t])}},s=o;e.exports=o},{"./map-helpers.js":3,d3:"d3",underscore:"underscore"}],3:[function(t,e){var a,r=t("d3"),n=t("underscore"),o=t("topojson"),s=r.shuffle(["#FF00FF","#CC00FF","#00FF00","#FFFF00","#00FFFF","#CCFF00","#FFCC00","#00FF99","#6600CC","#FF0099","#006666","#006600"]),i=function(t,e){var a=Math.pow(10,3*Math.abs(4-e));return{scale:e>4?function(t){return t/a}:function(t){return t*a},symbol:t}},c=["p","n","Âµ","m","","k","m","b","t"].map(i);a={partyScale:r.scale.ordinal().range(s),getWinner:function(t){return n.max(t.race.candidates,function(t){return t.voteCount})},getParties:function(t){return n.uniq(n.flatten(t.map(function(t){return t.candidates.map(function(t){return t.party})})))},getPartyVotes:function(t){var e=l.getParties(t).map(function(t){return{name:t,votes:0}});return t.forEach(function(t){t.candidates.forEach(function(a){66===a.voteCount&&console.log(t,a),n.findWhere(e,{name:a.party}).votes+=a.voteCount})}),e},getReportingUnitFromFipsCode:function(t,e){for(var a,r=0;"undefined"==typeof a&&r<t.length;r++){var n=t[r];n.fipsCode===e&&(t.splice(r,1),a=n)}return{race:a,races:t}},addRacesToUs:function(t,e){var a=o.feature(t,t.objects.counties).features;return a.map(function(t){var a=l.getReportingUnitFromFipsCode(e,t.id.toString());return t.race=a.race,e=a.races,t})},setStateData:function(t,e){var a=o.feature(t,t.objects.states).features;return a.map(function(t){if(2===t.id){var a=l.getReportingUnitFromFipsCode(e,"2000");t.race=a.race,e=a.races}return t})},setFill:function(t){if(t.race&&t.race.candidates){var e=a.getWinner(t);return e.party?a.partyScale(e.party):"url(#crosshatch)"}return"white"},toolTipHtml:function(t){var e=l.getWinner(t);return void 0===e.name?'<span class="winner-name">Vacant Seat</span>':'<span class="winner-name">'+e.name+'</span><span style="color:'+a.partyScale(e.party)+'">'+e.party+"</span>"},formatPrefixes:c,bbwNumberFormat:function(t){var e=Math.max(1,Math.min(1e12,t)),a=l.bbwFormatPrefix(e);return parseFloat(a.scale(t).toPrecision(3))+a.symbol},bbwFormatPrefix:function(t,e){var a=0;return t&&(0>t&&(t*=-1),e&&(t=r.round(t,d3_format_precision(t,e))),a=1+Math.floor(1e-12+Math.log(t)/Math.LN10),a=Math.max(-24,Math.min(24,3*Math.floor((0>=a?a+1:a-1)/3)))),l.formatPrefixes[4+a/3]}};var l=a;e.exports=a},{d3:"d3",topojson:"topojson",underscore:"underscore"}],4:[function(t,e){var a=t("d3");a.tip=t("./vendor/d3-tip")(a);var r=t("queue-async"),n=t("topojson"),o=(t("underscore"),t("./map-helpers.js")),s=t("./legend.js");e.exports=function(){function t(t,r,i){function c(){y.attr("transform","translate("+a.event.translate+")scale("+a.event.scale+")")}races=i.races;a.behavior.zoom().scaleExtent([.1,3]).on("zoom",c),a.behavior.drag().on("drag",function(){console.log("drag")});y.append("g").attr("class","counties").selectAll("path").data(o.addRacesToUs(r,races)).enter().append("path").attr("class","county").attr("d",h).style("fill",o.setFill).on("mouseover",function(t){t.race&&f.show(t)}).on("mouseout",f.hide),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||a.selectAll(".county").on("click",e),y.append("g").attr("id","states").selectAll("path").data(o.setStateData(r,races)).enter().append("path").attr("d",h).attr("class",function(t){return 2===t.id?"state alaska":"state"});a.select(".alaska").style("fill",function(t){return o.partyScale(t)}).on("mouseover",f.show).on("mouseout",f.hide);/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||a.select(".alaska").on("click",e),y.append("path").datum(n.mesh(r,r.objects.states,function(t,e){return t!==e})).attr("class","state-borders").attr("d",h),s.append(races),console.timeEnd("toph")}function e(t){var e,a,r;if(t&&c!==t){var n=h.centroid(t);e=n[0],a=n[1],r=4,c=t}else e=l/2,a=p/2,r=1,c=null;y.selectAll("path").classed("active",c&&function(t){return t===c}),y.transition().duration(750).attr("transform","translate("+l/2+","+p/2+")scale("+r+")translate("+-e+","+-a+")").style("stroke-width",1.5/r+"px")}function i(t){var e=o.getWinner(t);return void 0===e.name?'<span class="winner-name">Vacant Seat</span>':'<span class="winner-name">'+e.name+'</span><span style="color:'+o.partyScale(e.party)+'">'+e.party+"</span>"}console.time("toph");var c,l=parseInt(a.select("#map-container").style("width")),u=.6,p=l*u,d=1.2*l,f=a.tip().attr("class","d3-tip").html(i),m=(a.scale.linear().range([0,50]),a.geo.albersUsa().scale(d).translate([l/2,p/2])),h=a.geo.path().projection(m),v=a.select("#map-container").append("svg").attr("width",l).attr("height",p).call(f);v.append("rect").attr("class","background").attr("width",l).attr("height",p).on("click",e);var y=v.append("g"),g={method:"resize",height:document.documentElement.scrollHeight};window.parent.postMessage(g,"*"),r().defer(a.json,"data/us.json").defer(a.json,"data/updated_senate_by_county.json").await(t),a.select(self.frameElement).style("height",p+"px")}},{"./legend.js":2,"./map-helpers.js":3,"./vendor/d3-tip":"./vendor/d3-tip",d3:"d3","queue-async":"queue-async",topojson:"topojson",underscore:"underscore"}]},{},[1]);